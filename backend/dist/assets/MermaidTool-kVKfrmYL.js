import{r as e,h as t,w as a,B as n,z as l,E as i,y as s,C as r,D as o,ak as u,J as c,ah as d,M as m,O as f,W as v,G as g,F as p,K as h,T as b}from"./vue-vendor-CYJ4K8iR.js";import{am as y}from"./mermaid-DyLeeZ5J.js";import{_ as w}from"./index-BgaygjGV.js";import{E as x}from"./element-plus-rCXJXZ29.js";const _={class:"tool-container"},M={class:"tool-header"},k={class:"actions"},A={class:"feature-hints"},S={class:"editor-container"},C={class:"editor-panel"},R={class:"panel-header"},D={class:"editor-panel preview-panel"},L={class:"panel-header"},E={class:"preview-controls"},z={class:"zoom-display"},T={key:0,class:"error-message"},G={class:"error-detail"},U=["innerHTML"],q={class:"fullscreen-container"},O={class:"fullscreen-header"},N={class:"fullscreen-controls"},V={class:"zoom-display"},W=["innerHTML"],P=w({__name:"MermaidTool",setup(w){const P=e(""),B=e(""),j=e(""),F=e("default"),I=e(1),H=e(null),Y=e(null),$=e(null),X=e(!1),J=e(1);let Q=!1;const K=e(0),Z=e(0),ee=e(!1);let te=0,ae=0,ne=0,le=0;const ie=e(0),se=e(0),re=e(!1);let oe=0,ue=0,ce=0,de=0;const me=()=>{X.value=!X.value,X.value?(J.value=1,document.body.style.overflow="hidden"):document.body.style.overflow=""};let fe=null;const ve=()=>{y.initialize({startOnLoad:!1,theme:F.value,securityLevel:"loose",flowchart:{useMaxWidth:!0,htmlLabels:!0,curve:"basis"},sequence:{useMaxWidth:!0,diagramMarginX:50,diagramMarginY:10,actorMargin:50,width:150,height:65,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,mirrorActors:!0},gantt:{useMaxWidth:!0,barHeight:20,barGap:4,topPadding:50,leftPadding:75},pie:{useMaxWidth:!0},er:{useMaxWidth:!0}})},ge=async()=>{if(!P.value.trim())return B.value="",void(j.value="");try{ve();const e=`mermaid-${Date.now()}`,{svg:t}=await y.render(e,P.value);B.value=t,j.value=""}catch(e){j.value=e.message||"未知错误",B.value=""}},pe=()=>{fe&&clearTimeout(fe),fe=setTimeout(ge,300)},he=()=>{ge()},be=e=>{I.value=Math.min(10,Math.max(.25,e))},ye=()=>{be(1.25*I.value)},we=()=>{be(I.value/1.25)},xe=()=>{I.value=1,K.value=0,Z.value=0},_e=e=>{const t=e.deltaY>0?.9:1.1,a=Math.min(10,Math.max(.25,I.value*t));I.value=a},Me=e=>{0===e.button&&(ee.value=!0,te=e.clientX,ae=e.clientY,ne=K.value,le=Z.value)},ke=e=>{if(!ee.value)return;const t=e.clientX-te,a=e.clientY-ae;K.value=ne+t,Z.value=le+a},Ae=()=>{ee.value=!1},Se=()=>{J.value=Math.min(10,1.25*J.value)},Ce=()=>{J.value=Math.max(.25,J.value/1.25)},Re=()=>{J.value=1,ie.value=0,se.value=0},De=e=>{const t=e.deltaY>0?.9:1.1;J.value=Math.min(10,Math.max(.25,J.value*t))},Le=e=>{0===e.button&&(re.value=!0,oe=e.clientX,ue=e.clientY,ce=ie.value,de=se.value)},Ee=e=>{if(!re.value)return;const t=e.clientX-oe,a=e.clientY-ue;ie.value=ce+t,se.value=de+a},ze=()=>{re.value=!1},Te={flowchart:"flowchart TD\n    A[开始] --\x3e B{是否满足条件?}\n    B --\x3e|是| C[执行操作 A]\n    B --\x3e|否| D[执行操作 B]\n    C --\x3e E[处理结果]\n    D --\x3e E\n    E --\x3e F[结束]",sequence:"sequenceDiagram\n    participant 用户\n    participant 前端\n    participant 后端\n    participant 数据库\n\n    用户->>前端: 发起请求\n    前端->>后端: API 调用\n    后端->>数据库: 查询数据\n    数据库--\x3e>后端: 返回结果\n    后端--\x3e>前端: 返回响应\n    前端--\x3e>用户: 显示结果",classDiagram:"classDiagram\n    class Animal {\n        +String name\n        +int age\n        +makeSound()\n    }\n    class Dog {\n        +String breed\n        +bark()\n        +fetch()\n    }\n    class Cat {\n        +String color\n        +meow()\n        +scratch()\n    }\n    Animal <|-- Dog\n    Animal <|-- Cat",stateDiagram:"stateDiagram-v2\n    [*] --\x3e 待处理\n    待处理 --\x3e 处理中: 开始处理\n    处理中 --\x3e 已完成: 处理成功\n    处理中 --\x3e 失败: 处理失败\n    失败 --\x3e 处理中: 重试\n    已完成 --\x3e [*]",erDiagram:"erDiagram\n    CUSTOMER ||--o{ ORDER : places\n    ORDER ||--|{ LINE-ITEM : contains\n    CUSTOMER {\n        string name\n        string email\n        int customerId\n    }\n    ORDER {\n        int orderId\n        date orderDate\n        string status\n    }\n    LINE-ITEM {\n        int quantity\n        float price\n        string productName\n    }",gantt:"gantt\n    title 项目开发计划\n    dateFormat  YYYY-MM-DD\n    section 设计阶段\n    需求分析           :a1, 2024-01-01, 7d\n    系统设计           :a2, after a1, 5d\n    UI 设计            :a3, after a1, 7d\n    section 开发阶段\n    前端开发           :b1, after a2, 14d\n    后端开发           :b2, after a2, 14d\n    API 联调           :b3, after b1, 5d\n    section 测试阶段\n    功能测试           :c1, after b3, 7d\n    性能测试           :c2, after c1, 3d\n    上线部署           :milestone, after c2, 0d",pie:'pie showData\n    title 技术栈使用比例\n    "Vue.js" : 35\n    "React" : 30\n    "Angular" : 15\n    "Svelte" : 10\n    "其他" : 10',mindmap:"mindmap\n  root((前端技术))\n    框架\n      Vue\n        Vue 2\n        Vue 3\n      React\n        Hooks\n        Redux\n      Angular\n    构建工具\n      Webpack\n      Vite\n      Rollup\n    样式\n      CSS\n      Sass\n      TailwindCSS\n    测试\n      Jest\n      Vitest\n      Cypress",timeline:"timeline\n    title 互联网发展史\n    section 早期\n      1969 : ARPANET 诞生\n      1971 : 第一封电子邮件\n    section WWW 时代\n      1989 : WWW 概念提出\n      1993 : Mosaic 浏览器\n      1995 : JavaScript 诞生\n    section 现代\n      2004 : Web 2.0 时代\n      2008 : HTML5 草案\n      2015 : ES6 发布",gitGraph:'gitGraph\n    commit id: "初始化项目"\n    commit id: "添加基础功能"\n    branch develop\n    checkout develop\n    commit id: "开发新功能"\n    commit id: "功能完善"\n    checkout main\n    merge develop id: "合并开发分支"\n    commit id: "发布 v1.0"',quadrant:"quadrantChart\n    title 技术评估矩阵\n    x-axis 低复杂度 --\x3e 高复杂度\n    y-axis 低价值 --\x3e 高价值\n    quadrant-1 优先实施\n    quadrant-2 需要规划\n    quadrant-3 可以考虑\n    quadrant-4 暂时搁置\n    功能A: [0.3, 0.8]\n    功能B: [0.7, 0.9]\n    功能C: [0.2, 0.3]\n    功能D: [0.8, 0.4]",sankey:"sankey-beta\n    访问量,注册,500\n    访问量,跳出,300\n    注册,活跃用户,350\n    注册,流失,150\n    活跃用户,付费,200\n    活跃用户,免费,150"},Ge=e=>{P.value=Te[e]||"",ge()},Ue=async()=>{if(B.value)try{const e=Y.value?.querySelector("svg");if(!e)return void x.error("无法获取 SVG 元素");const t=e.cloneNode(!0),a=e.getBoundingClientRect();let n=a.width,l=a.height;const i=e.getAttribute("viewBox");if(i){const e=i.split(/\s+/);if(4===e.length){const t=parseFloat(e[2]),a=parseFloat(e[3]);t>n&&(n=t),a>l&&(l=a)}}const s=e.getAttribute("width"),r=e.getAttribute("height");if(s&&!s.includes("%")){const e=parseFloat(s);e>n&&(n=e)}if(r&&!r.includes("%")){const e=parseFloat(r);e>l&&(l=e)}const o=40;n=Math.max(n,200)+o,l=Math.max(l,100)+o,t.setAttribute("width",n),t.setAttribute("height",l),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.getAttribute("viewBox")||t.setAttribute("viewBox",`0 0 ${n} ${l}`);const u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("width",n),u.setAttribute("height",l),u.setAttribute("fill","#ffffff");const c=t.querySelector(":scope > :not(style):not(defs)");c?t.insertBefore(u,c):t.appendChild(u);const d=t.querySelectorAll("*"),m=e.querySelectorAll("*");d.forEach((e,t)=>{const a=m[t];if(!a)return;const n=window.getComputedStyle(a);if(["fill","stroke","stroke-width","stroke-dasharray","font-family","font-size","font-weight","font-style","text-anchor","dominant-baseline","alignment-baseline","opacity","fill-opacity","stroke-opacity","transform","display","visibility","letter-spacing","word-spacing","line-height"].forEach(t=>{const a=n.getPropertyValue(t);a&&"none"!==a&&"normal"!==a&&""!==a&&(["fill","stroke","stroke-width","opacity","text-anchor","dominant-baseline"].includes(t)&&e.setAttribute(t,a),e.style[t]=a)}),"text"===e.tagName||"tspan"===e.tagName){const t=a.getAttribute("x"),n=a.getAttribute("y"),l=a.getAttribute("dx"),i=a.getAttribute("dy");t&&e.setAttribute("x",t),n&&e.setAttribute("y",n),l&&e.setAttribute("dx",l),i&&e.setAttribute("dy",i)}});let f=(new XMLSerializer).serializeToString(t);const v=new Blob([f],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(v),p=new Image;p.crossOrigin="anonymous",p.onload=()=>{try{const e=document.createElement("canvas"),t=2;e.width=n*t,e.height=l*t;const a=e.getContext("2d");a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.scale(t,t),a.fillStyle="#ffffff",a.fillRect(0,0,n,l),a.drawImage(p,0,0,n,l),URL.revokeObjectURL(g),e.toBlob(e=>{if(e){const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`mermaid-diagram-${Date.now()}.png`,a.click(),URL.revokeObjectURL(t),x.success("PNG 图片已下载")}else x.error("PNG 导出失败")},"image/png",1)}catch(e){URL.revokeObjectURL(g),x.error("PNG 导出失败: "+e.message)}},p.onerror=e=>{URL.revokeObjectURL(g),x.error("PNG 导出失败")},p.src=g}catch(e){x.error("PNG 导出失败: "+e.message)}else x.warning("没有可导出的图表")},qe=()=>{if(B.value)try{const e=Y.value?.querySelector("svg");if(!e)return void x.error("无法获取 SVG 元素");const t=e.cloneNode(!0),a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#ffffff"),t.insertBefore(a,t.firstChild);let n=(new XMLSerializer).serializeToString(t);n='<?xml version="1.0" encoding="UTF-8"?>\n'+n;const l=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(l),s=document.createElement("a");s.href=i,s.download=`mermaid-diagram-${Date.now()}.svg`,s.click(),URL.revokeObjectURL(i),x.success("SVG 文件已下载")}catch(e){x.error("SVG 导出失败: "+e.message)}else x.warning("没有可导出的图表")},Oe=async()=>{if(P.value)try{await navigator.clipboard.writeText(P.value),x.success("代码已复制到剪贴板")}catch(e){const t=document.createElement("textarea");t.value=P.value,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),x.success("代码已复制到剪贴板")}else x.warning("没有可复制的代码")};return t(()=>{ve(),P.value=Te.flowchart,ge()}),a(F,()=>{he()}),(e,t)=>{const a=u("Files"),y=u("el-icon"),w=u("el-button"),x=u("el-dropdown-item"),te=u("el-dropdown-menu"),ae=u("el-dropdown"),ne=u("el-option"),le=u("el-select"),oe=u("Picture"),ue=u("Download"),ce=u("CopyDocument"),de=u("el-tag"),fe=u("Minus"),ve=u("Plus"),ge=u("Refresh"),be=u("FullScreen"),Te=u("WarningFilled"),Ne=u("Close");return l(),n("div",_,[i("div",M,[t[19]||(t[19]=i("h2",null,"Mermaid 图表编辑器",-1)),i("div",k,[r(ae,{onCommand:Ge,trigger:"click"},{dropdown:o(()=>[r(te,null,{default:o(()=>[r(x,{command:"flowchart"},{default:o(()=>[...t[4]||(t[4]=[m("流程图 (Flowchart)",-1)])]),_:1}),r(x,{command:"sequence"},{default:o(()=>[...t[5]||(t[5]=[m("时序图 (Sequence)",-1)])]),_:1}),r(x,{command:"classDiagram"},{default:o(()=>[...t[6]||(t[6]=[m("类图 (Class)",-1)])]),_:1}),r(x,{command:"stateDiagram"},{default:o(()=>[...t[7]||(t[7]=[m("状态图 (State)",-1)])]),_:1}),r(x,{command:"erDiagram"},{default:o(()=>[...t[8]||(t[8]=[m("ER 图",-1)])]),_:1}),r(x,{command:"gantt"},{default:o(()=>[...t[9]||(t[9]=[m("甘特图 (Gantt)",-1)])]),_:1}),r(x,{command:"pie"},{default:o(()=>[...t[10]||(t[10]=[m("饼图 (Pie)",-1)])]),_:1}),r(x,{command:"mindmap"},{default:o(()=>[...t[11]||(t[11]=[m("思维导图 (Mindmap)",-1)])]),_:1}),r(x,{command:"timeline"},{default:o(()=>[...t[12]||(t[12]=[m("时间线 (Timeline)",-1)])]),_:1}),r(x,{command:"gitGraph"},{default:o(()=>[...t[13]||(t[13]=[m("Git 图 (Git Graph)",-1)])]),_:1}),r(x,{command:"quadrant"},{default:o(()=>[...t[14]||(t[14]=[m("象限图 (Quadrant)",-1)])]),_:1}),r(x,{command:"sankey"},{default:o(()=>[...t[15]||(t[15]=[m("桑基图 (Sankey)",-1)])]),_:1})]),_:1})]),default:o(()=>[r(w,null,{default:o(()=>[r(y,null,{default:o(()=>[r(a)]),_:1}),t[3]||(t[3]=m(" 插入模板 ",-1))]),_:1})]),_:1}),r(le,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),placeholder:"主题",style:{width:"120px"},onChange:he},{default:o(()=>[r(ne,{label:"默认",value:"default"}),r(ne,{label:"森林",value:"forest"}),r(ne,{label:"暗黑",value:"dark"}),r(ne,{label:"中性",value:"neutral"}),r(ne,{label:"基础",value:"base"})]),_:1},8,["modelValue"]),r(w,{type:"success",onClick:Ue},{default:o(()=>[r(y,null,{default:o(()=>[r(oe)]),_:1}),t[16]||(t[16]=m(" 导出 PNG ",-1))]),_:1}),r(w,{type:"primary",onClick:qe},{default:o(()=>[r(y,null,{default:o(()=>[r(ue)]),_:1}),t[17]||(t[17]=m(" 导出 SVG ",-1))]),_:1}),r(w,{onClick:Oe},{default:o(()=>[r(y,null,{default:o(()=>[r(ce)]),_:1}),t[18]||(t[18]=m(" 复制代码 ",-1))]),_:1})])]),i("div",A,[r(de,{type:"success",size:"small"},{default:o(()=>[...t[20]||(t[20]=[m("实时预览",-1)])]),_:1}),r(de,{type:"info",size:"small"},{default:o(()=>[...t[21]||(t[21]=[m("多种图表类型",-1)])]),_:1}),r(de,{type:"warning",size:"small"},{default:o(()=>[...t[22]||(t[22]=[m("PNG/SVG 导出",-1)])]),_:1}),r(de,{size:"small"},{default:o(()=>[...t[23]||(t[23]=[m("主题切换",-1)])]),_:1})]),i("div",S,[i("div",C,[i("div",R,[t[26]||(t[26]=i("span",null,"Mermaid 代码",-1)),j.value?(l(),s(de,{key:0,type:"danger",size:"small"},{default:o(()=>[...t[24]||(t[24]=[m("语法错误",-1)])]),_:1})):(l(),s(de,{key:1,type:"success",size:"small"},{default:o(()=>[...t[25]||(t[25]=[m("语法正确",-1)])]),_:1}))]),c(i("textarea",{ref_key:"editorRef",ref:$,"onUpdate:modelValue":t[1]||(t[1]=e=>P.value=e),class:"code-editor",placeholder:"输入 Mermaid 代码...",spellcheck:"false",onInput:pe,onScroll:t[2]||(t[2]=e=>(()=>{if(Q)return;Q=!0;const e=$.value,t=H.value;if(e&&t){const a=e.scrollTop/(e.scrollHeight-e.clientHeight||1);t.scrollTop=a*(t.scrollHeight-t.clientHeight)}requestAnimationFrame(()=>{Q=!1})})())},null,544),[[d,P.value]])]),i("div",D,[i("div",L,[t[27]||(t[27]=i("span",null,[m("预览 "),i("small",{class:"zoom-hint"},"(滚轮缩放 / 拖拽平移)")],-1)),i("div",E,[r(w,{size:"small",onClick:we,disabled:I.value<=.25},{default:o(()=>[r(y,null,{default:o(()=>[r(fe)]),_:1})]),_:1},8,["disabled"]),i("span",z,f(Math.round(100*I.value))+"%",1),r(w,{size:"small",onClick:ye,disabled:I.value>=10},{default:o(()=>[r(y,null,{default:o(()=>[r(ve)]),_:1})]),_:1},8,["disabled"]),r(w,{size:"small",onClick:xe,title:"重置缩放和位置"},{default:o(()=>[r(y,null,{default:o(()=>[r(ge)]),_:1})]),_:1}),r(w,{size:"small",onClick:me},{default:o(()=>[r(y,null,{default:o(()=>[r(be)]),_:1})]),_:1})])]),i("div",{class:g(["preview-content",{"is-dragging":ee.value}]),ref_key:"previewRef",ref:H,onWheel:v(_e,["prevent"]),onMousedown:Me,onMousemove:ke,onMouseup:Ae,onMouseleave:Ae},[j.value?(l(),n("div",T,[r(y,null,{default:o(()=>[r(Te)]),_:1}),i("div",null,[t[28]||(t[28]=i("div",{class:"error-title"},"图表渲染错误",-1)),i("pre",G,f(j.value),1)])])):(l(),n("div",{key:1,ref_key:"diagramRef",ref:Y,class:"diagram-container",style:p({transform:`translate(${K.value}px, ${Z.value}px) scale(${I.value})`,transformOrigin:"center center"}),innerHTML:B.value},null,12,U))],34)])]),(l(),s(b,{to:"body"},[X.value?(l(),n("div",{key:0,class:"fullscreen-overlay",onClick:v(me,["self"])},[i("div",q,[i("div",O,[t[30]||(t[30]=i("span",null,[m("全屏预览 "),i("small",{class:"zoom-hint"},"(滚轮缩放 / 拖拽平移)")],-1)),i("div",N,[r(w,{size:"small",onClick:Ce,disabled:J.value<=.25},{default:o(()=>[r(y,null,{default:o(()=>[r(fe)]),_:1})]),_:1},8,["disabled"]),i("span",V,f(Math.round(100*J.value))+"%",1),r(w,{size:"small",onClick:Se,disabled:J.value>=10},{default:o(()=>[r(y,null,{default:o(()=>[r(ve)]),_:1})]),_:1},8,["disabled"]),r(w,{size:"small",onClick:Re,title:"重置缩放和位置"},{default:o(()=>[r(y,null,{default:o(()=>[r(ge)]),_:1})]),_:1}),r(w,{type:"danger",size:"small",onClick:me},{default:o(()=>[r(y,null,{default:o(()=>[r(Ne)]),_:1}),t[29]||(t[29]=m(" 关闭 ",-1))]),_:1})])]),i("div",{class:g(["fullscreen-content",{"is-dragging":re.value}]),onWheel:v(De,["prevent"]),onMousedown:Le,onMousemove:Ee,onMouseup:ze,onMouseleave:ze},[i("div",{class:"fullscreen-diagram",style:p({transform:`translate(${ie.value}px, ${se.value}px) scale(${J.value})`,transformOrigin:"center center"}),innerHTML:B.value},null,12,W)],34)])])):h("",!0)]))])}}},[["__scopeId","data-v-7c0889f0"]]);export{P as default};
