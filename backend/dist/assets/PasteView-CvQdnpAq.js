import{r as e,c as a,l,B as t,z as s,K as n,C as u,E as r,D as o,ak as i,O as c,aw as d,u as v,W as p,M as m}from"./vue-vendor-CdeIc39u.js";import{l as f,n as _,o as h,E as g}from"./element-plus-BIlKvLmW.js";import{H as w}from"./highlight-B9qKoII_.js";/* empty css                    */import{_ as y}from"./index-DnEAA98D.js";import"./mermaid-Bo_AvqXD.js";const k={class:"tool-container"},b={key:0,class:"loading"},x={key:1,class:"password-section"},C={class:"card-header"},j={key:0,class:"error-text"},L={key:2,class:"error-section"},z={key:3,class:"paste-content"},U={class:"paste-header"},$={class:"paste-title"},D={class:"paste-meta"},R={class:"editor-panel"},E={class:"panel-header"},H={class:"actions"},M=["innerHTML"],T={class:"back-section"},V=y({__name:"PasteView",setup(y){const V=d(),B=e(!0),I=e(null),O=e(""),S=e(!1),K=e(""),N=e(""),P=e(!1),W=async(e="")=>{const a=V.params.id;if(!a)return O.value="无效的分享 ID",void(B.value=!1);try{const l=e?`/api/paste/${a}?password=${encodeURIComponent(e)}`:`/api/paste/${a}`,t=await fetch(l),s=await t.json();401===t.status?s.has_password?(S.value=!0,N.value=e?"密码错误":""):O.value=s.error||"访问被拒绝":t.ok?(I.value=s,S.value=!1):O.value=s.error||"加载失败"}catch(l){O.value="网络错误，请稍后重试"}finally{B.value=!1,P.value=!1}},q=async()=>{K.value?(P.value=!0,N.value="",await W(K.value)):N.value="请输入密码"},A=a(()=>{if(!I.value)return"";const e=I.value.language,a=I.value.content;if(w.getLanguage(e))try{return w.highlight(a,{language:e}).value}catch(l){return F(a)}return F(a)}),F=e=>{const a=document.createElement("div");return a.textContent=e,a.innerHTML},G=e=>new Date(e).toLocaleString("zh-CN"),J=async()=>{try{await navigator.clipboard.writeText(I.value.content),g.success("已复制到剪贴板")}catch(e){g.error("复制失败")}},Q=()=>{const e=new Blob([I.value.content],{type:"text/plain"}),a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=`${I.value.title||I.value.id}.txt`,l.click(),URL.revokeObjectURL(a)};return l(()=>{W()}),(e,a)=>{const l=i("el-icon"),d=i("el-input"),g=i("el-form-item"),w=i("el-button"),y=i("el-form"),V=i("el-card"),W=i("el-result"),F=i("el-tag"),X=i("CopyDocument"),Y=i("Download");return s(),t("div",k,[B.value?(s(),t("div",b,[u(l,{class:"is-loading",size:32},{default:o(()=>[u(v(f))]),_:1}),a[3]||(a[3]=r("span",null,"加载中...",-1))])):S.value?(s(),t("div",x,[u(V,{class:"password-card"},{header:o(()=>[r("div",C,[u(l,null,{default:o(()=>[u(v(_))]),_:1}),a[4]||(a[4]=r("span",null,"需要密码访问",-1))])]),default:o(()=>[u(y,{onSubmit:p(q,["prevent"])},{default:o(()=>[u(g,{label:"访问密码"},{default:o(()=>[u(d,{modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),type:"password",placeholder:"请输入访问密码","show-password":""},null,8,["modelValue"])]),_:1}),u(g,null,{default:o(()=>[u(w,{type:"primary",onClick:q,loading:P.value},{default:o(()=>[...a[5]||(a[5]=[m(" 验证 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),N.value?(s(),t("div",j,c(N.value),1)):n("",!0)]),_:1})])):O.value?(s(),t("div",L,[u(W,{icon:"error",title:O.value},{extra:o(()=>[u(w,{type:"primary",onClick:a[1]||(a[1]=a=>e.$router.push("/paste"))},{default:o(()=>[...a[6]||(a[6]=[m(" 创建新分享 ",-1)])]),_:1})]),_:1},8,["title"])])):I.value?(s(),t("div",z,[r("div",U,[r("div",$,[r("h2",null,c(I.value.title||"无标题"),1),u(F,{size:"small"},{default:o(()=>[m(c(I.value.language),1)]),_:1})]),r("div",D,[r("span",null,"创建于 "+c(G(I.value.created_at)),1),a[7]||(a[7]=r("span",null,"·",-1)),r("span",null,"访问 "+c(I.value.views)+"/"+c(I.value.max_views),1),a[8]||(a[8]=r("span",null,"·",-1)),r("span",null,"过期于 "+c(G(I.value.expires_at)),1)])]),r("div",R,[r("div",E,[a[11]||(a[11]=r("span",null,"内容",-1)),r("div",H,[u(w,{size:"small",onClick:J},{default:o(()=>[u(l,null,{default:o(()=>[u(X)]),_:1}),a[9]||(a[9]=m(" 复制 ",-1))]),_:1}),u(w,{size:"small",onClick:Q},{default:o(()=>[u(l,null,{default:o(()=>[u(Y)]),_:1}),a[10]||(a[10]=m(" 下载 ",-1))]),_:1})])]),r("pre",{class:"code-content",innerHTML:A.value},null,8,M)]),r("div",T,[u(w,{onClick:a[2]||(a[2]=a=>e.$router.push("/paste"))},{default:o(()=>[u(l,null,{default:o(()=>[u(v(h))]),_:1}),a[12]||(a[12]=m(" 创建新分享 ",-1))]),_:1})])])):n("",!0)])}}},[["__scopeId","data-v-f9d6749b"]]);export{V as default};
