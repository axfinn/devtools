import{r as e,c as a,h as l,B as s,z as t,K as u,C as n,E as i,D as r,ak as c,O as v,y as o,M as d,P as p,a4 as m,W as g,aw as f,u as _}from"./vue-vendor-CYJ4K8iR.js";import{x as y,y as h,z as k,p as w,A as C,B as b,E as x}from"./element-plus-rCXJXZ29.js";import{H as j}from"./highlight-Gn2QFnDo.js";/* empty css                    */import{_ as z}from"./index-BgaygjGV.js";import"./mermaid-DyLeeZ5J.js";const L={class:"tool-container"},$={key:0,class:"loading"},E={key:1,class:"password-section"},U={class:"card-header"},R={key:0,class:"error-text"},T={key:2,class:"error-section"},B={key:3,class:"paste-content"},D={class:"paste-header"},H={class:"paste-title"},M={class:"paste-meta"},V={key:0,class:"editor-panel"},I={class:"panel-header"},O={class:"actions"},P=["innerHTML"],S={key:1,class:"image-gallery"},A={class:"gallery-header"},K={class:"gallery-title"},N={class:"gallery-grid"},W=["onClick"],q=["src"],F={class:"gallery-overlay"},G={class:"preview-container"},J=["src"],Q={class:"preview-actions"},X={class:"preview-index"},Y={class:"back-section"},Z=z({__name:"PasteView",setup(z){const Z=f(),ee=e(!0),ae=e(null),le=e(""),se=e(!1),te=e(""),ue=e(""),ne=e(!1),ie=e(null),re=e(0),ce=async(e="")=>{const a=Z.params.id;if(!a)return le.value="无效的分享 ID",void(ee.value=!1);try{const l=e?`/api/paste/${a}?password=${encodeURIComponent(e)}`:`/api/paste/${a}`,s=await fetch(l),t=await s.json();401===s.status?t.has_password?(se.value=!0,ue.value=e?"密码错误":""):le.value=t.error||"访问被拒绝":s.ok?(ae.value=t,se.value=!1):le.value=t.error||"加载失败"}catch(l){le.value="网络错误，请稍后重试"}finally{ee.value=!1,ne.value=!1}},ve=async()=>{te.value?(ne.value=!0,ue.value="",await ce(te.value)):ue.value="请输入密码"},oe=a(()=>{if(!ae.value)return"";const e=ae.value.language,a=ae.value.content;if(j.getLanguage(e))try{return j.highlight(a,{language:e}).value}catch(l){return de(a)}return de(a)}),de=e=>{const a=document.createElement("div");return a.textContent=e,a.innerHTML},pe=e=>new Date(e).toLocaleString("zh-CN"),me=async()=>{try{await navigator.clipboard.writeText(ae.value.content),x.success("已复制到剪贴板")}catch(e){x.error("复制失败")}},ge=()=>{const e=new Blob([ae.value.content],{type:"text/plain"}),a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=`${ae.value.title||ae.value.id}.txt`,l.click(),URL.revokeObjectURL(a)},fe=()=>{ie.value=null},_e=()=>{re.value>0&&(re.value--,ie.value=ae.value.images[re.value])},ye=()=>{re.value<ae.value.images.length-1&&(re.value++,ie.value=ae.value.images[re.value])},he=(e,a)=>{const l=document.createElement("a");l.href=e;const s=e.match(/^data:image\/(\w+);/),t=s?s[1]:"png";l.download=`${ae.value.title||ae.value.id}_${a+1}.${t}`,l.click()},ke=()=>{ae.value.images.forEach((e,a)=>{setTimeout(()=>he(e,a),100*a)})};return l(()=>{ce()}),(e,a)=>{const l=c("el-icon"),f=c("el-input"),x=c("el-form-item"),j=c("el-button"),z=c("el-form"),Z=c("el-card"),ce=c("el-result"),de=c("el-tag"),we=c("CopyDocument");return t(),s("div",L,[ee.value?(t(),s("div",$,[n(l,{class:"is-loading",size:32},{default:r(()=>[n(_(y))]),_:1}),a[4]||(a[4]=i("span",null,"加载中...",-1))])):se.value?(t(),s("div",E,[n(Z,{class:"password-card"},{header:r(()=>[i("div",U,[n(l,null,{default:r(()=>[n(_(h))]),_:1}),a[5]||(a[5]=i("span",null,"需要密码访问",-1))])]),default:r(()=>[n(z,{onSubmit:g(ve,["prevent"])},{default:r(()=>[n(x,{label:"访问密码"},{default:r(()=>[n(f,{modelValue:te.value,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value=e),type:"password",placeholder:"请输入访问密码","show-password":""},null,8,["modelValue"])]),_:1}),n(x,null,{default:r(()=>[n(j,{type:"primary",onClick:ve,loading:ne.value},{default:r(()=>[...a[6]||(a[6]=[d(" 验证 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),ue.value?(t(),s("div",R,v(ue.value),1)):u("",!0)]),_:1})])):le.value?(t(),s("div",T,[n(ce,{icon:"error",title:le.value},{extra:r(()=>[n(j,{type:"primary",onClick:a[1]||(a[1]=a=>e.$router.push("/paste"))},{default:r(()=>[...a[7]||(a[7]=[d(" 创建新分享 ",-1)])]),_:1})]),_:1},8,["title"])])):ae.value?(t(),s("div",B,[i("div",D,[i("div",H,[i("h2",null,v(ae.value.title||"无标题"),1),n(de,{size:"small"},{default:r(()=>[d(v(ae.value.language),1)]),_:1})]),i("div",M,[i("span",null,"创建于 "+v(pe(ae.value.created_at)),1),a[8]||(a[8]=i("span",null,"·",-1)),i("span",null,"访问 "+v(ae.value.views)+"/"+v(ae.value.max_views),1),a[9]||(a[9]=i("span",null,"·",-1)),i("span",null,"过期于 "+v(pe(ae.value.expires_at)),1)])]),ae.value.content?(t(),s("div",V,[i("div",I,[a[12]||(a[12]=i("span",null,"内容",-1)),i("div",O,[n(j,{size:"small",onClick:me},{default:r(()=>[n(l,null,{default:r(()=>[n(we)]),_:1}),a[10]||(a[10]=d(" 复制 ",-1))]),_:1}),n(j,{size:"small",onClick:ge},{default:r(()=>[n(l,null,{default:r(()=>[n(_(k))]),_:1}),a[11]||(a[11]=d(" 下载 ",-1))]),_:1})])]),i("pre",{class:"code-content",innerHTML:oe.value},null,8,P)])):u("",!0),ae.value.images&&ae.value.images.length>0?(t(),s("div",S,[i("div",A,[i("span",K,[n(l,null,{default:r(()=>[n(_(w))]),_:1}),d(" 图片 ("+v(ae.value.images.length)+") ",1)]),ae.value.images.length>1?(t(),o(j,{key:0,size:"small",onClick:ke},{default:r(()=>[n(l,null,{default:r(()=>[n(_(k))]),_:1}),a[13]||(a[13]=d(" 下载全部 ",-1))]),_:1})):u("",!0)]),i("div",N,[(t(!0),s(p,null,m(ae.value.images,(e,a)=>(t(),s("div",{class:"gallery-item",key:a,onClick:e=>(e=>{re.value=e,ie.value=ae.value.images[e]})(a)},[i("img",{src:e,alt:"图片"},null,8,q),i("div",F,[n(l,{size:24},{default:r(()=>[n(_(C))]),_:1})])],8,W))),128))])])):u("",!0),ie.value?(t(),s("div",{key:2,class:"image-preview",onClick:g(fe,["self"])},[i("div",G,[i("img",{src:ie.value,alt:"预览"},null,8,J),i("div",Q,[n(j,{circle:"",onClick:_e,disabled:0===re.value},{default:r(()=>[n(l,null,{default:r(()=>[n(_(b))]),_:1})]),_:1},8,["disabled"]),i("span",X,v(re.value+1)+" / "+v(ae.value.images.length),1),n(j,{circle:"",onClick:ye,disabled:re.value===ae.value.images.length-1},{default:r(()=>[n(l,{style:{transform:"rotate(180deg)"}},{default:r(()=>[n(_(b))]),_:1})]),_:1},8,["disabled"]),n(j,{circle:"",onClick:a[2]||(a[2]=e=>he(ie.value,re.value))},{default:r(()=>[n(l,null,{default:r(()=>[n(_(k))]),_:1})]),_:1}),n(j,{circle:"",type:"danger",onClick:fe},{default:r(()=>[...a[14]||(a[14]=[d(" ✕ ",-1)])]),_:1})])])])):u("",!0),i("div",Y,[n(j,{onClick:a[3]||(a[3]=a=>e.$router.push("/paste"))},{default:r(()=>[n(l,null,{default:r(()=>[n(_(b))]),_:1}),a[15]||(a[15]=d(" 创建新分享 ",-1))]),_:1})])])):u("",!0)])}}},[["__scopeId","data-v-3f88adaa"]]);export{Z as default};
