import{r as e,B as l,z as a,C as t,D as s,ak as u,K as r,E as i,ag as o,u as d,M as n,O as c,y as v,n as p}from"./vue-vendor-CYJ4K8iR.js";import{w as m,y as f,G as g,H as _,C as y,o as w,I as b,E as h}from"./element-plus-rCXJXZ29.js";import{Q as x}from"./browser-DwEqQEri.js";import{_ as k}from"./index-BgaygjGV.js";import"./qrcode-DA2KNt05.js";import"./mermaid-DyLeeZ5J.js";const V={class:"container mx-auto p-4 max-w-4xl"},C={class:"flex items-center justify-between"},U={key:0,class:"space-y-4"},z={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},j={key:1,class:"space-y-4"},I={key:2,class:"mt-6 space-y-4"},D={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},L={class:"flex items-center gap-2"},R={class:"text-center"},$={class:"inline-block p-4 bg-white rounded-lg"},E={class:"flex gap-2 justify-center"},S={class:"flex gap-2"},T={key:0,class:"mt-4"},q=["href"],K={class:"flex items-center justify-between"},O={class:"flex gap-2"},N={key:2,class:"text-center text-gray-400 py-4"},A=k({__name:"ShortUrl",setup(k){const A=e(""),B=e(720),G=e(1e3),H=e(""),J=e(""),M=e(!1),P=e(!1),Q=e(""),Z=e({}),F=e({}),W=e(null),X=e({}),Y=e(""),ee=e(!1),le=e(null),ae=e(""),te=e(!1),se=e(!1),ue=e([]),re=async e=>{if(A.value.trim())if((e=>{try{const l=new URL(e);return!!["http:","https:"].includes(l.protocol)}catch{return!1}})(A.value.trim())){if(J.value){if(J.value.length>32)return void h.error("自定义ID长度不能超过32个字符");if(!/^[a-zA-Z0-9_-]+$/.test(J.value))return void h.error("自定义ID只能包含字母、数字、下划线和短横线")}P.value=!0;try{const l={original_url:A.value.trim(),expires_in:e||B.value,max_clicks:G.value};M.value&&(H.value&&(l.password=H.value),J.value&&(l.custom_id=J.value));const a=await fetch("/api/shorturl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),t=await a.json();if(!a.ok)throw new Error(t.error||"创建失败");Z.value=t,Q.value=t.short_url,F.value={clicks:0},h.success("短链生成成功！"),await p(),W.value&&await x.toCanvas(W.value,t.short_url,{width:200,margin:2}),ie()}catch(l){h.error(l.message||"创建短链失败")}finally{P.value=!1}}else h.error("请输入有效的 URL（必须以 http:// 或 https:// 开头）");else h.warning("请输入要缩短的 URL")},ie=async()=>{try{await navigator.clipboard.writeText(Q.value),h.success("已复制到剪贴板")}catch{h.warning("复制失败，请手动复制")}},oe=async()=>{if(Z.value.id)try{const e=await fetch(`/api/shorturl/${Z.value.id}/stats`),l=await e.json();if(!e.ok)throw new Error(l.error||"获取统计信息失败");F.value=l,h.success("统计信息已更新")}catch(e){h.error(e.message)}},de=()=>{A.value="",Q.value="",Z.value={},F.value={},B.value=720,G.value=1e3,J.value=""},ne=()=>{Q.value&&window.open(Q.value,"_blank")},ce=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},ve=async()=>{if(Y.value.trim()){ee.value=!0,le.value=null;try{const e=await fetch(`/api/shorturl/${Y.value.trim()}/stats`),l=await e.json();if(!e.ok)throw new Error(l.error||"查询失败");le.value=l}catch(e){h.error(e.message)}finally{ee.value=!1}}else h.warning("请输入短链ID")},pe=async()=>{if(ae.value){te.value=!0;try{const e=await fetch(`/api/shorturl/list?password=${encodeURIComponent(ae.value)}`),l=await e.json();if(!e.ok)throw new Error(l.error||"加载失败");ue.value=l.urls||[],se.value=!0,h.success(`已加载 ${ue.value.length} 条记录`)}catch(e){h.error(e.message)}finally{te.value=!1}}else h.warning("请输入管理密码")};return(e,p)=>{const x=u("el-switch"),k=u("el-icon"),me=u("el-input"),fe=u("el-button"),ge=u("el-form-item"),_e=u("el-option"),ye=u("el-select"),we=u("el-input-number"),be=u("el-form"),he=u("el-divider"),xe=u("el-descriptions-item"),ke=u("el-tag"),Ve=u("el-descriptions"),Ce=u("el-card"),Ue=u("el-table-column"),ze=u("el-table"),je=u("el-empty");return a(),l("div",V,[t(Ce,null,{header:s(()=>[i("div",C,[p[16]||(p[16]=i("span",{class:"text-xl font-bold"},"短链生成器",-1)),t(x,{modelValue:M.value,"onUpdate:modelValue":p[0]||(p[0]=e=>M.value=e),"active-text":"高级模式","inactive-text":"快捷模式"},null,8,["modelValue"])])]),default:s(()=>[M.value?(a(),l("div",j,[t(be,{model:X.value,"label-width":"120px"},{default:s(()=>[t(ge,{label:"原始 URL",required:""},{default:s(()=>[t(me,{modelValue:A.value,"onUpdate:modelValue":p[7]||(p[7]=e=>A.value=e),placeholder:"https://example.com",clearable:""},{prefix:s(()=>[t(k,null,{default:s(()=>[t(d(m))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(ge,{label:"管理密码"},{default:s(()=>[t(me,{modelValue:H.value,"onUpdate:modelValue":p[8]||(p[8]=e=>H.value=e),type:"password",placeholder:"如需自定义短链ID，请输入管理密码",clearable:"","show-password":""},{prefix:s(()=>[t(k,null,{default:s(()=>[t(d(f))]),_:1})]),_:1},8,["modelValue"]),p[21]||(p[21]=i("div",{class:"text-sm text-gray-500 mt-1"}," 配置密码后可使用自定义短链ID ",-1))]),_:1}),t(ge,{label:"自定义短链ID"},{default:s(()=>[t(me,{modelValue:J.value,"onUpdate:modelValue":p[9]||(p[9]=e=>J.value=e),placeholder:"如: 1, abc, my-link（需要密码）",clearable:"",disabled:!H.value},{prefix:s(()=>[t(k,null,{default:s(()=>[t(d(g))]),_:1})]),_:1},8,["modelValue","disabled"]),p[22]||(p[22]=i("div",{class:"text-sm text-gray-500 mt-1"}," 只能包含字母、数字、下划线、短横线，最长32字符 ",-1))]),_:1}),t(ge,{label:"过期时间"},{default:s(()=>[t(ye,{modelValue:B.value,"onUpdate:modelValue":p[10]||(p[10]=e=>B.value=e),placeholder:"选择过期时间",class:"w-full"},{default:s(()=>[t(_e,{label:"1 小时",value:1}),t(_e,{label:"6 小时",value:6}),t(_e,{label:"12 小时",value:12}),t(_e,{label:"1 天",value:24}),t(_e,{label:"3 天",value:72}),t(_e,{label:"7 天",value:168}),t(_e,{label:"30 天（默认）",value:720}),t(_e,{label:"90 天",value:2160}),t(_e,{label:"180 天",value:4320}),t(_e,{label:"1 年",value:8760})]),_:1},8,["modelValue"])]),_:1}),t(ge,{label:"最大点击次数"},{default:s(()=>[t(we,{modelValue:G.value,"onUpdate:modelValue":p[11]||(p[11]=e=>G.value=e),min:1,max:1e5,step:100,class:"w-full"},null,8,["modelValue"]),p[23]||(p[23]=i("div",{class:"text-sm text-gray-500 mt-1"}," 默认 1000 次，最多 100000 次 ",-1))]),_:1}),t(ge,null,{default:s(()=>[t(fe,{type:"primary",onClick:p[12]||(p[12]=e=>re(B.value)),loading:P.value,size:"large",class:"w-full"},{default:s(()=>[...p[24]||(p[24]=[n(" 生成短链 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):(a(),l("div",U,[t(me,{modelValue:A.value,"onUpdate:modelValue":p[1]||(p[1]=e=>A.value=e),placeholder:"输入要缩短的 URL（例如：https://example.com）",size:"large",clearable:"",onKeyup:p[2]||(p[2]=o(e=>re(720),["enter"]))},{prefix:s(()=>[t(k,null,{default:s(()=>[t(d(m))]),_:1})]),_:1},8,["modelValue"]),i("div",z,[t(fe,{type:"primary",size:"large",onClick:p[3]||(p[3]=e=>re(24)),loading:P.value,class:"w-full"},{default:s(()=>[...p[17]||(p[17]=[n(" 1 天 ",-1)])]),_:1},8,["loading"]),t(fe,{type:"primary",size:"large",onClick:p[4]||(p[4]=e=>re(168)),loading:P.value,class:"w-full"},{default:s(()=>[...p[18]||(p[18]=[n(" 7 天 ",-1)])]),_:1},8,["loading"]),t(fe,{type:"primary",size:"large",onClick:p[5]||(p[5]=e=>re(720)),loading:P.value,class:"w-full"},{default:s(()=>[...p[19]||(p[19]=[n(" 30 天 ",-1)])]),_:1},8,["loading"]),t(fe,{type:"primary",size:"large",onClick:p[6]||(p[6]=e=>re(8760)),loading:P.value,class:"w-full"},{default:s(()=>[...p[20]||(p[20]=[n(" 1 年 ",-1)])]),_:1},8,["loading"])])])),Q.value?(a(),l("div",I,[t(he),i("div",D,[p[26]||(p[26]=i("div",{class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},"生成的短链：",-1)),i("div",L,[t(me,{modelValue:Q.value,"onUpdate:modelValue":p[13]||(p[13]=e=>Q.value=e),readonly:"",size:"large"},{prefix:s(()=>[t(k,null,{default:s(()=>[t(d(m))]),_:1})]),_:1},8,["modelValue"]),t(fe,{type:"primary",onClick:ie,icon:d(_),size:"large"},{default:s(()=>[...p[25]||(p[25]=[n(" 复制 ",-1)])]),_:1},8,["icon"])])]),t(Ve,{column:2,border:""},{default:s(()=>[t(xe,{label:"短链 ID"},{default:s(()=>[n(c(Z.value.id),1)]),_:1}),t(xe,{label:"过期时间"},{default:s(()=>[n(c(ce(Z.value.expires_at)),1)]),_:1}),t(xe,{label:"最大点击数"},{default:s(()=>[n(c(Z.value.max_clicks),1)]),_:1}),t(xe,{label:"当前点击数"},{default:s(()=>[t(ke,{type:"info"},{default:s(()=>[n(c(F.value.clicks||0),1)]),_:1})]),_:1})]),_:1}),i("div",R,[p[27]||(p[27]=i("div",{class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},"扫码访问",-1)),i("div",$,[i("canvas",{ref_key:"qrcodeCanvas",ref:W},null,512)])]),i("div",E,[t(fe,{onClick:oe,icon:d(y)},{default:s(()=>[...p[28]||(p[28]=[n(" 刷新统计 ",-1)])]),_:1},8,["icon"]),t(fe,{onClick:de,icon:d(w)},{default:s(()=>[...p[29]||(p[29]=[n(" 生成新短链 ",-1)])]),_:1},8,["icon"]),t(fe,{onClick:ne,icon:d(b)},{default:s(()=>[...p[30]||(p[30]=[n(" 测试访问 ",-1)])]),_:1},8,["icon"])])])):r("",!0)]),_:1}),t(Ce,{class:"mt-4"},{header:s(()=>[...p[31]||(p[31]=[i("span",{class:"font-bold"},"查询短链统计",-1)])]),default:s(()=>[i("div",S,[t(me,{modelValue:Y.value,"onUpdate:modelValue":p[14]||(p[14]=e=>Y.value=e),placeholder:"输入短链ID查询统计",clearable:"",onKeyup:o(ve,["enter"])},null,8,["modelValue"]),t(fe,{type:"primary",onClick:ve,loading:ee.value},{default:s(()=>[...p[32]||(p[32]=[n(" 查询 ",-1)])]),_:1},8,["loading"])]),le.value?(a(),l("div",T,[t(Ve,{column:2,border:"",size:"small"},{default:s(()=>[t(xe,{label:"短链ID"},{default:s(()=>[n(c(le.value.id),1)]),_:1}),t(xe,{label:"点击次数"},{default:s(()=>[t(ke,null,{default:s(()=>[n(c(le.value.clicks),1)]),_:1})]),_:1}),t(xe,{label:"原始URL",span:2},{default:s(()=>[i("a",{href:le.value.original_url,target:"_blank",class:"text-blue-500 break-all"},c(le.value.original_url),9,q)]),_:1}),t(xe,{label:"过期时间"},{default:s(()=>[n(c(ce(le.value.expires_at)),1)]),_:1}),t(xe,{label:"最大点击"},{default:s(()=>[n(c(le.value.max_clicks),1)]),_:1})]),_:1})])):r("",!0)]),_:1}),t(Ce,{class:"mt-4"},{header:s(()=>[i("div",K,[p[34]||(p[34]=i("span",{class:"font-bold"},"短链列表",-1)),i("div",O,[t(me,{modelValue:ae.value,"onUpdate:modelValue":p[15]||(p[15]=e=>ae.value=e),type:"password",placeholder:"管理密码",size:"small",style:{width:"150px"},"show-password":""},null,8,["modelValue"]),t(fe,{type:"primary",size:"small",onClick:pe,loading:te.value},{default:s(()=>[...p[33]||(p[33]=[n(" 加载列表 ",-1)])]),_:1},8,["loading"])])])]),default:s(()=>[ue.value.length?(a(),v(ze,{key:0,data:ue.value,size:"small","max-height":"400"},{default:s(()=>[t(Ue,{prop:"id",label:"ID",width:"100"}),t(Ue,{prop:"original_url",label:"原始URL","show-overflow-tooltip":""}),t(Ue,{prop:"clicks",label:"点击",width:"80",align:"center"},{default:s(({row:e})=>[t(ke,{size:"small"},{default:s(()=>[n(c(e.clicks),1)]),_:2},1024)]),_:1}),t(Ue,{prop:"expires_at",label:"过期时间",width:"160"},{default:s(({row:e})=>[n(c(ce(e.expires_at)),1)]),_:1}),t(Ue,{label:"操作",width:"80",align:"center"},{default:s(({row:e})=>[t(fe,{link:"",size:"small",onClick:l=>(async e=>{const l=`${window.location.origin}/s/${e}`;try{await navigator.clipboard.writeText(l),h.success("已复制")}catch{h.warning("复制失败")}})(e.id)},{default:s(()=>[...p[35]||(p[35]=[n("复制",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):se.value?(a(),v(je,{key:1,description:"暂无数据"})):(a(),l("div",N,"输入密码后点击加载"))]),_:1})])}}},[["__scopeId","data-v-c21b1305"]]);export{A as default};
