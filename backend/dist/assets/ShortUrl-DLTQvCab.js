import{r as e,B as l,z as a,C as t,D as s,ak as i,K as u,E as r,ag as o,u as n,M as d,O as c,n as v}from"./vue-vendor-CYJ4K8iR.js";import{w as m,G as p,C as f,o as g,H as y,E as _}from"./element-plus-dcQV5w3x.js";import{Q as b}from"./browser-Dvgp9tZk.js";import{_ as x}from"./index-CT3p-j8z.js";import"./qrcode-DA2KNt05.js";import"./mermaid-BoZA0hCz.js";const h={class:"container mx-auto p-4 max-w-4xl"},w={class:"flex items-center justify-between"},k={key:0,class:"space-y-4"},V={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},C={key:1,class:"space-y-4"},U={key:2,class:"mt-6 space-y-4"},j={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},z={class:"flex items-center gap-2"},L={class:"text-center"},R={class:"inline-block p-4 bg-white rounded-lg"},T={class:"flex gap-2 justify-center"},S=x({__name:"ShortUrl",setup(x){const S=e(""),E=e(720),P=e(1e3),q=e(!1),D=e(!1),H=e(""),I=e({}),O=e({}),K=e(null),N=e({}),B=async e=>{if(S.value.trim())if((e=>{try{const l=new URL(e);return!!["http:","https:"].includes(l.protocol)}catch{return!1}})(S.value.trim())){D.value=!0;try{const l=await fetch("/api/shorturl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_url:S.value.trim(),expires_in:e||E.value,max_clicks:P.value})}),a=await l.json();if(!l.ok)throw new Error(a.error||"创建失败");I.value=a,H.value=a.short_url,O.value={clicks:0},_.success("短链生成成功！"),await v(),K.value&&await b.toCanvas(K.value,a.short_url,{width:200,margin:2}),G()}catch(l){_.error(l.message||"创建短链失败")}finally{D.value=!1}}else _.error("请输入有效的 URL（必须以 http:// 或 https:// 开头）");else _.warning("请输入要缩短的 URL")},G=async()=>{try{await navigator.clipboard.writeText(H.value),_.success("已复制到剪贴板")}catch{_.warning("复制失败，请手动复制")}},J=async()=>{if(I.value.id)try{const e=await fetch(`/api/shorturl/${I.value.id}/stats`),l=await e.json();if(!e.ok)throw new Error(l.error||"获取统计信息失败");O.value=l,_.success("统计信息已更新")}catch(e){_.error(e.message)}},M=()=>{S.value="",H.value="",I.value={},O.value={},E.value=720,P.value=1e3},Q=()=>{H.value&&window.open(H.value,"_blank")},$=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return(e,v)=>{const _=i("el-switch"),b=i("el-icon"),x=i("el-input"),A=i("el-button"),F=i("el-form-item"),W=i("el-option"),X=i("el-select"),Y=i("el-input-number"),Z=i("el-form"),ee=i("el-divider"),le=i("el-descriptions-item"),ae=i("el-tag"),te=i("el-descriptions"),se=i("el-card");return a(),l("div",h,[t(se,null,{header:s(()=>[r("div",w,[v[12]||(v[12]=r("span",{class:"text-xl font-bold"},"短链生成器",-1)),t(_,{modelValue:q.value,"onUpdate:modelValue":v[0]||(v[0]=e=>q.value=e),"active-text":"高级模式","inactive-text":"快捷模式"},null,8,["modelValue"])])]),default:s(()=>[q.value?(a(),l("div",C,[t(Z,{model:N.value,"label-width":"120px"},{default:s(()=>[t(F,{label:"原始 URL",required:""},{default:s(()=>[t(x,{modelValue:S.value,"onUpdate:modelValue":v[7]||(v[7]=e=>S.value=e),placeholder:"https://example.com",clearable:""},{prefix:s(()=>[t(b,null,{default:s(()=>[t(n(m))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(F,{label:"过期时间"},{default:s(()=>[t(X,{modelValue:E.value,"onUpdate:modelValue":v[8]||(v[8]=e=>E.value=e),placeholder:"选择过期时间",class:"w-full"},{default:s(()=>[t(W,{label:"1 小时",value:1}),t(W,{label:"6 小时",value:6}),t(W,{label:"12 小时",value:12}),t(W,{label:"1 天",value:24}),t(W,{label:"3 天",value:72}),t(W,{label:"7 天",value:168}),t(W,{label:"30 天（默认）",value:720}),t(W,{label:"90 天",value:2160}),t(W,{label:"180 天",value:4320}),t(W,{label:"1 年",value:8760})]),_:1},8,["modelValue"])]),_:1}),t(F,{label:"最大点击次数"},{default:s(()=>[t(Y,{modelValue:P.value,"onUpdate:modelValue":v[9]||(v[9]=e=>P.value=e),min:1,max:1e5,step:100,class:"w-full"},null,8,["modelValue"]),v[17]||(v[17]=r("div",{class:"text-sm text-gray-500 mt-1"}," 默认 1000 次，最多 100000 次 ",-1))]),_:1}),t(F,null,{default:s(()=>[t(A,{type:"primary",onClick:v[10]||(v[10]=e=>B(E.value)),loading:D.value,size:"large",class:"w-full"},{default:s(()=>[...v[18]||(v[18]=[d(" 生成短链 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):(a(),l("div",k,[t(x,{modelValue:S.value,"onUpdate:modelValue":v[1]||(v[1]=e=>S.value=e),placeholder:"输入要缩短的 URL（例如：https://example.com）",size:"large",clearable:"",onKeyup:v[2]||(v[2]=o(e=>B(720),["enter"]))},{prefix:s(()=>[t(b,null,{default:s(()=>[t(n(m))]),_:1})]),_:1},8,["modelValue"]),r("div",V,[t(A,{type:"primary",size:"large",onClick:v[3]||(v[3]=e=>B(24)),loading:D.value,class:"w-full"},{default:s(()=>[...v[13]||(v[13]=[d(" 1 天 ",-1)])]),_:1},8,["loading"]),t(A,{type:"primary",size:"large",onClick:v[4]||(v[4]=e=>B(168)),loading:D.value,class:"w-full"},{default:s(()=>[...v[14]||(v[14]=[d(" 7 天 ",-1)])]),_:1},8,["loading"]),t(A,{type:"primary",size:"large",onClick:v[5]||(v[5]=e=>B(720)),loading:D.value,class:"w-full"},{default:s(()=>[...v[15]||(v[15]=[d(" 30 天 ",-1)])]),_:1},8,["loading"]),t(A,{type:"primary",size:"large",onClick:v[6]||(v[6]=e=>B(8760)),loading:D.value,class:"w-full"},{default:s(()=>[...v[16]||(v[16]=[d(" 1 年 ",-1)])]),_:1},8,["loading"])])])),H.value?(a(),l("div",U,[t(ee),r("div",j,[v[20]||(v[20]=r("div",{class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},"生成的短链：",-1)),r("div",z,[t(x,{modelValue:H.value,"onUpdate:modelValue":v[11]||(v[11]=e=>H.value=e),readonly:"",size:"large"},{prefix:s(()=>[t(b,null,{default:s(()=>[t(n(m))]),_:1})]),_:1},8,["modelValue"]),t(A,{type:"primary",onClick:G,icon:n(p),size:"large"},{default:s(()=>[...v[19]||(v[19]=[d(" 复制 ",-1)])]),_:1},8,["icon"])])]),t(te,{column:2,border:""},{default:s(()=>[t(le,{label:"短链 ID"},{default:s(()=>[d(c(I.value.id),1)]),_:1}),t(le,{label:"过期时间"},{default:s(()=>[d(c($(I.value.expires_at)),1)]),_:1}),t(le,{label:"最大点击数"},{default:s(()=>[d(c(I.value.max_clicks),1)]),_:1}),t(le,{label:"当前点击数"},{default:s(()=>[t(ae,{type:"info"},{default:s(()=>[d(c(O.value.clicks||0),1)]),_:1})]),_:1})]),_:1}),r("div",L,[v[21]||(v[21]=r("div",{class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},"扫码访问",-1)),r("div",R,[r("canvas",{ref_key:"qrcodeCanvas",ref:K},null,512)])]),r("div",T,[t(A,{onClick:J,icon:n(f)},{default:s(()=>[...v[22]||(v[22]=[d(" 刷新统计 ",-1)])]),_:1},8,["icon"]),t(A,{onClick:M,icon:n(g)},{default:s(()=>[...v[23]||(v[23]=[d(" 生成新短链 ",-1)])]),_:1},8,["icon"]),t(A,{onClick:Q,icon:n(y)},{default:s(()=>[...v[24]||(v[24]=[d(" 测试访问 ",-1)])]),_:1},8,["icon"])])])):u("",!0)]),_:1}),t(se,{class:"mt-4"},{header:s(()=>[...v[25]||(v[25]=[r("span",{class:"font-bold"},"使用说明",-1)])]),default:s(()=>[v[26]||(v[26]=r("ul",{class:"list-disc list-inside space-y-2 text-sm text-gray-600 dark:text-gray-400"},[r("li",null,"支持 HTTP 和 HTTPS 协议的 URL"),r("li",null,"短链默认 30 天过期，最长 1 年"),r("li",null,"默认最大点击 1000 次，可自定义（最多 100000 次）"),r("li",null,"达到点击限制或过期后，短链将自动删除"),r("li",null,"每个 IP 每小时最多创建 10 个短链"),r("li",null,"URL 最大长度 2048 字符")],-1))]),_:1})])}}},[["__scopeId","data-v-e40cfa10"]]);export{S as default};
